!function(t){function e(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var s={};e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function i(t,e,s){this.options=s||{};var i={historySize:50,unknownCover:"http://i.imgur.com/NpYCAVP.png"};for(var r in i)i.hasOwnProperty(r)&&!this.options.hasOwnProperty(r)&&(this.options[r]=i[r]);this.stream=new n(t,s),this.player=e,this.currentCover=0,this.historyFetched=0,this.historyUnfetched=0,this.history=[],this.state="paused",this.mutedState=!1,this.dom={player:"#player",coverParent:".cover",cover:".cover > .image",backgroundCover:".background-cover",artist:".artist",streamname:".streamname",streamer:".info > .meta > .streamer",songtitle:".songtitle",prevCoverButton:".info > .cover > .triangle.triangle-left",nextCoverButton:".info > .cover > .triangle.triangle-right",listeners:".info > .stats > .listeners",maxlisteners:".info > .stats > .maxlisteners",volume:".info > .volume > input[type=range]",canvas:".info > .cover > canvas"};for(var o in this.dom)this.dom.hasOwnProperty(o)&&(this.dom[o]=document.querySelector(this.dom[o]));this.ctx=null,this.dom.canvas&&(this.ctx=this.dom.canvas.getContext("2d")),this.animFrame=null,this.maxSpectrumHeight=.1,this.playButton=e.querySelector(".playbutton"),this.muteButton=e.querySelector(".mute"),this.stopButton=e.querySelector(".stop"),this.play=function(){"stopped"===this.state||"paused"===this.state?(this.stream.play(),this.state="playing",this.draw()):(this.stream.pause(),this.state="paused",window.cancelAnimationFrame(this.animFrame)),this.updateControls()},this.mute=function(){this.mutedState?this.stream.unmute():this.stream.mute(),this.mutedState=!this.mutedState,this.mutedState?this.muteButton.classList.add("muted"):this.muteButton.classList.remove("muted")},this.stop=function(){this.stream.audio.currentTime=0;var t=this.stream.audio.src;this.stream.audio.src="",this.stream.audio.src=t,this.state="stopped",this.updateControls()},this.updateControls=function(){"playing"===this.state?this.playButton.classList.add("paused"):"paused"===this.state?this.playButton.classList.remove("paused"):"stopped"===this.state&&(this.playButton.classList.remove("paused"),this.stopButton.classList.toggle("stopped"))},this.setCover=function(t){if(this.currentCover=t,this.history[0].fetched){0===t?this.dom.nextCoverButton.classList.add("disabled"):t===this.history.length-1?this.dom.prevCoverButton.classList.add("disabled"):(this.dom.prevCoverButton.classList.remove("disabled"),this.dom.nextCoverButton.classList.remove("disabled"));var e;this.history[t].fetched.hasOwnProperty("cover")?(e=this.history[t].fetched.cover,this.dom.songtitle.textContent=this.history[t].fetched.trackName,this.dom.artist.textContent=this.history[t].fetched.artist):(e=this.options.unknownCover,this.dom.songtitle.textContent=this.history[t].title.split(" - ")[0],this.dom.artist.textContent=this.history[t].title.split(" - ")[1]||" "),this.dom.cover.style.background="#323232 url('"+e+"') no-repeat 50% 50% / cover",this.dom.backgroundCover.style.background="#323232 url('"+e+"') no-repeat 50% 50%/auto 110%"}},this.draw=function(){this.analyser.getByteFrequencyData(this.frequency);for(var t=parseInt(this.dom.canvas.width/3),e=parseInt(.9*this.frequency.length/t),s=new Array(t),i=0;i<t;i++){var n=this.frequency.slice(e*i,e*(i+1));s[i]=this.maxSpectrumHeight*n.reduce(function(t,e){return t+e})/n.length}this.ctx.clearRect(0,0,this.dom.canvas.width,this.dom.canvas.height);var r=this.ctx.createLinearGradient(0,0,0,this.dom.canvas.height);r.addColorStop(0,"rgba(255, 255, 255, 0.7)"),r.addColorStop(1,"rgba(255, 255, 255, 0.01)"),this.ctx.fillStyle=r;for(var i=0,o=0;i<s.length;i++,o+=3)this.ctx.fillRect(0,o,s[i],2),this.ctx.fillRect(this.dom.canvas.width,o,-s[i],2);this.animFrame=window.requestAnimationFrame(this.draw.bind(this))},this.initializeCanvas=function(){if(!this.dom.canvas)return!1;this.ctx.canvas.width=this.dom.coverParent.offsetWidth,this.ctx.canvas.height=this.dom.coverParent.offsetHeight,this.stream.audio.crossOrigin="anonymous",this.context=new AudioContext,this.analyser=this.context.createAnalyser(),this.analyser.connect(this.context.destination),this.source=this.context.createMediaElementSource(this.stream.audio),this.source.connect(this.analyser),this.analyser.connect(this.context.destination),this.frequency=new Uint8Array(this.analyser.frequencyBinCount)},this.nextCover=function(){return this.currentCover>0&&(this.currentCover--,this.setCover(this.currentCover)),this.currentCover},this.prevCover=function(){return this.currentCover<this.history.length-1&&(this.currentCover++,this.setCover(this.currentCover)),this.currentCover},this.updateVolume=function(t){this.stream.setVolume(t.target.value)},this.songExistsInHistory=function(t){for(var e=0;e<this.history.length;e++)if(t.playedat===this.history[e].playedat)return!0;return!1},this.mergeHistory=function(t){(t=t.reverse()).map(function(t){this.songExistsInHistory(t)||this.history.unshift(t)},this)},this.countUnfetched=function(){var t=0;return this.history.map(function(e){e.hasOwnProperty("fetched")||t++},this),t},this.playButton.addEventListener("click",this.play.bind(this)),this.muteButton.addEventListener("click",this.mute.bind(this)),this.stopButton.addEventListener("click",this.stop.bind(this)),this.dom.volume.addEventListener("input",this.updateVolume.bind(this)),this.dom.nextCoverButton.addEventListener("click",this.nextCover.bind(this)),this.dom.prevCoverButton.addEventListener("click",this.prevCover.bind(this)),document.addEventListener("statsFetched",function(t){t.detail.error||(this.dom.streamname.textContent=t.detail.response.servertitle,this.dom.streamer.textContent=t.detail.response.servergenre,this.dom.listeners.textContent=t.detail.response.currentlisteners,this.dom.maxlisteners.textContent=t.detail.response.maxlisteners)}.bind(this)),this.initializeCanvas(),document.addEventListener("historyFetched",function(t){var e=this;this.mergeHistory(t.detail.response),this.history.map(function(t){if(!t.hasOwnProperty("fetched")){this.historyUnfetched++;var s=new XMLHttpRequest;s.open("GET","https://itunes.apple.com/search?media=music&term="+t.title.replace(/,* +(|-|&)* */g,"+"),!0),s.addEventListener("readystatechange",function(){if(this.readyState===this.DONE&&200===this.status){var s=""!==this.responseText?JSON.parse(this.responseText):null;if(null!==s&&s.resultCount>0){var i=s.results[0];t.fetched={trackName:i.trackName,artist:i.artistName,cover:i.artworkUrl100}}else t.fetched={};e.historyFetched++,e.historyUnfetched===e.historyFetched&&(e.historyUnfetched=0,e.historyFetched=0,e.setCover(0))}}),s.send(null)}},this)}.bind(this))}var n=s(1);document.addEventListener("DOMContentLoaded",function(){window.player=new i("http://4stream.pl:18240",document.getElementById("player"))})},function(t,e,s){"use strict";function i(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return t.split("").map(function(t){return e[t]||t}).join("")}var n=s(2);t.exports=function(t,e){this.url=t,this.options=e||{};var s={historyTimeout:12e4,statsTimeout:6e4,path:{history:"/played",stats:"/stats"},streamID:1};for(var r in s)s.hasOwnProperty(r)&&!this.options.hasOwnProperty(r)&&(this.options[r]=s[r]);this.audio=new Audio(t+"/;"),this.statsFetchedEvent=new CustomEvent("statsFetched",{detail:null}),this.historyFetchedEvent=new CustomEvent("historyFetched",{detail:null}),this.statsInterval=null,this.historyInterval=null,this.mute=function(){this.audio.mute=!this.audio.mute},this.fetchResource=function(t){n.ajax({url:"https://crossorigin.me/"+t.path},function(e,s){if(200===e)try{s=JSON.parse(s);for(var n in s)s.hasOwnProperty(n)&&"string"==typeof s[n]&&(s[n]=i(s[n]));return t.customEvent=new CustomEvent(t.resourceType+"Fetched",{detail:{response:s,error:null}}),document.dispatchEvent(t.customEvent),0}catch(t){}t.customEvent=new CustomEvent(t.resourceType+"Fetched",{detail:{response:null,error:1}}),document.dispatchEvent(t.customEvent)}.bind(this))},this.fetchStats=function(){this.fetchResource({customEvent:this.statsFetchedEvent,resourceType:"stats",path:this.url+this.options.path.stats+"?json=1&sid="+this.options.streamID})},this.fetchHistory=function(){this.fetchResource({customEvent:this.historyFetchedEvent,resourceType:"history",path:this.url+this.options.path.history+"?type=json&sid="+this.options.streamID})},this.fetch=function(t,e){this.fetchHistory(e),this.fetchStats(t),this.statsInterval=setInterval(function(){this.fetchStats(t)}.bind(this),this.options.statsTimeout),this.historyInterval=setInterval(function(){this.fetchHistory(e)}.bind(this),this.options.historyTimeout)},this.stopFetching=function(){clearInterval(this.statsInterval),clearInterval(this.historyInterval)},this.play=function(){this.audio.play(),this.fetch(this.statsCallback,this.historyCallback)},this.pause=function(){this.audio.pause(),this.stopFetching()},this.mute=function(){this.audio.muted=!0},this.unmute=function(){this.audio.muted=!1},this.setVolume=function(t){return t>=0&&t<=1&&(this.audio.volume=t,!0)}}},function(t,e){(function(t){function s(e){return e&&t.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent)?new XDomainRequest:t.XMLHttpRequest?new XMLHttpRequest:void 0}function i(t,e,s){t[e]=t[e]||s}var n=["responseType","withCredentials","timeout","onprogress"];e.ajax=function(e,r){function o(t,e){return function(){c||(r(void 0===d.status?t:d.status,0===d.status?"Error":d.response||d.responseText||e,d),c=!0)}}var a=e.headers||{},h=e.body,u=e.method||(h?"POST":"GET"),c=!1,d=s(e.cors);d.open(u,e.url,!0);var l=d.onload=o(200);d.onreadystatechange=function(){4===d.readyState&&l()},d.onerror=o(null,"Error"),d.ontimeout=o(null,"Timeout"),d.onabort=o(null,"Abort"),h&&(i(a,"X-Requested-With","XMLHttpRequest"),t.FormData&&h instanceof t.FormData||i(a,"Content-Type","application/x-www-form-urlencoded"));for(var m=0,p=n.length;m<p;m++)void 0!==e[v=n[m]]&&(d[v]=e[v]);for(var v in a)d.setRequestHeader(v,a[v]);return d.send(h),d}}).call(e,function(){return this}())}]);